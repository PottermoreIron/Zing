server:
  port: 8081

spring:
  application:
    name: auth-service

  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: dev
        group: DEFAULT_GROUP

  # Redis配置
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
      timeout: 3000ms

# Auth服务配置
auth:
  # 缓存类型：redis | local | composite
  cache:
    type: redis

  # Token配置
  token:
    # Token提供者：spring-security | shiro
    provider: spring-security
    # JWT配置
    jwt:
      # RSA私钥文件路径
      private-key-location: classpath:keys/jwt_private_key.pem
      # RSA公钥文件路径
      public-key-location: classpath:keys/jwt_public_key.pem
      # AccessToken过期时间（秒）
      access-token-ttl: 3600
      # RefreshToken过期时间（秒）
      refresh-token-ttl: 2592000
      # RefreshToken滑动窗口（秒，7天内刷新会续期）
      refresh-token-sliding-window: 604800

  # 分布式锁配置
  lock:
    type: redis

  # 用户域配置
  user-domain:
    member:
      enabled: true
    admin:
      enabled: false

  # 权限系统配置
  permission:
    # 权限缓存配置
    cache:
      # Redis缓存过期时间（秒）
      redis-ttl: 3600
      # 本地缓存过期时间（秒）
      local-ttl: 300
      # 本地缓存最大条目数
      local-max-size: 10000
      # 布隆过滤器预期容量
      bloom-capacity: 100000
      # 布隆过滤器误判率
      bloom-fpp: 0.01

    # 消息队列配置
    mq:
      # 交换机名称
      exchange: auth.permission.exchange
      # 队列名称
      queue: auth.permission.changed
      # 路由键
      routing-key: permission.changed
      # 是否启用MQ
      enabled: false

    # 权限表达式配置
    expression:
      # 是否启用缓存
      cache-enabled: true
      # 表达式缓存大小
      cache-size: 1000

# 日志配置
logging:
  level:
    com.pot.auth: DEBUG
    org.springframework.security: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
